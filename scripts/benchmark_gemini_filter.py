"""
Gemini 2.5 Flash + Rule Filter ë²¤ì¹˜ë§ˆí¬ - 27ê°œ ì „ì²´ ì¼€ì´ìŠ¤
"""
import sys
import os
import io

if sys.platform == 'win32':
    sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')
    sys.stderr = io.TextIOWrapper(sys.stderr.buffer, encoding='utf-8')

sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))

from dotenv import load_dotenv
load_dotenv()

from src.llm.gemini_detector import GeminiPhishingDetector
import time

# === ì „ì²´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ===
test_cases = [
    # Category A: ì „í†µì  ë³´ì´ìŠ¤í”¼ì‹± (1-10)
    {"id": "A01", "cat": "A", "name": "ë…¸ê³¨ì  ìœ„í˜‘", "text": "ì•¼, ì„œìš¸ì§€ê²€ì¸ë° ë„ˆ ëŒ€í¬í†µì¥ ì‹ ê³  ë“¤ì–´ì™”ì–´. ì§€ê¸ˆ ë‹¹ì¥ ê°€ê¹Œìš´ ëª¨í…”ë¡œ íŠ€ì–´ì™€. ì•ˆ ì˜¤ë©´ ë°”ë¡œ ìˆ˜ë°° ë•Œë¦°ë‹¤. í° ë„ì§€ ë§ê³  ë§í¬ ë³´ë‚´ëŠ” ê±° ê¹”ì•„.", "min": 90, "type": "phishing"},
    {"id": "A02", "cat": "A", "name": "ì–´ì„¤í”ˆ ì‚¬ì¹­", "text": "ì—¬ê¸°ëŠ” ì¤‘ì•™ì§€ë°©ê²€ì°°ì²­ì…ë‹ˆë‹¤. ë³¸ì¸ ê³„ì¢Œê°€ ë²”ì£„ì— ì—°ë£¨ë˜ì–´ ë™ê²° ì˜ˆì •ì…ë‹ˆë‹¤. ë³´ì•ˆ ê²€ì‚¬ë¥¼ ìœ„í•´ ëª¨í…” ë“± ì¡°ìš©í•œ ê³³ìœ¼ë¡œ ì´ë™í•´ì„œ 'íŒ€ë·°ì–´' ì–´í”Œì„ ì„¤ì¹˜í•˜ì‹­ì‹œì˜¤.", "min": 85, "type": "phishing"},
    {"id": "A03", "cat": "A", "name": "ì „í˜•ì  ì‹œë‚˜ë¦¬ì˜¤", "text": "ê¹€ì² ìˆ˜ ê²€ì‚¬ì…ë‹ˆë‹¤. ìˆ˜ì‚¬ ê¸°ë°€ ìœ ì§€ë¥¼ ìœ„í•´ ì œ3ìê°€ ì—†ëŠ” ë…ë¦½ëœ ê³µê°„ì´ í•„ìš”í•©ë‹ˆë‹¤. ì£¼ë³€ ì†ŒìŒì´ ì„ì´ë©´ ë…¹ì·¨ê°€ ì¦ê±°ë¡œ ì±„íƒì´ ì•ˆ ë©ë‹ˆë‹¤. ê·¼ì²˜ ìˆ™ë°•ì—…ì†Œë¡œ ì´ë™í•˜ì‹œê³ , ë¹„ëŒ€ë©´ ì¡°ì‚¬ë¥¼ ìœ„í•œ ë³´ì•ˆ ì•±ì„ ì„¤ì¹˜í•´ì£¼ì„¸ìš”.", "min": 85, "type": "phishing"},
    {"id": "A04", "cat": "A", "name": "í”¼í•´ì êµ¬ì œ ë¹™ì", "text": "ì„ ìƒë‹˜, ì§€ê¸ˆ ì„ ìƒë‹˜ì´ í”¼ì˜ìê°€ ì•„ë‹ˆë¼ í”¼í•´ì ì…ì¥ì´ì‹  ê±¸ ì†Œëª…í•˜ë ¤ëŠ” ê²ë‹ˆë‹¤. ë‹¤ë§Œ, ë…¹ì·¨ ì¤‘ì— ì£¼ë³€ ì¡ìŒì´ë‚˜ íƒ€ì¸ì˜ ëª©ì†Œë¦¬ê°€ ì„ì´ë©´ ì¦ê±° íš¨ë ¥ì´ ì‚¬ë¼ì ¸ìš”. ê·¸ë˜ì„œ ëŒë³´ë‹¤ëŠ” ë°©ìŒì´ í™•ì‹¤í•œ ìŠ¤í„°ë””ë£¸ì´ë‚˜ ë¹„ì¦ˆë‹ˆìŠ¤ í˜¸í…”ì„ ê¶Œì¥ ë“œë¦¬ëŠ” ê²ë‹ˆë‹¤.", "min": 75, "type": "phishing"},
    {"id": "A05", "cat": "A", "name": "ê¸°ìˆ  ì§€ì› ìœ„ì¥", "text": "ì§€ê¸ˆ í°ì´ í•´í‚¹ëœ ìƒíƒœë¼ ìœ„ì¹˜ ì¶”ì ì´ ë˜ê³  ìˆì–´ìš”. ëŒìœ¼ë¡œ ê°€ì‹œë©´ ë²”ì¸ë“¤ì´ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë‹¨ ê³µê³µ ì™€ì´íŒŒì´ê°€ ì—†ëŠ” ì•ˆì „í•œ ì¥ì†Œë¡œ í”¼ì‹ í•˜ì…”ì•¼ í•˜ê³ ìš”, í•´í‚¹ ì°¨ë‹¨ì„ ìœ„í•´ í•œêµ­ì¸í„°ë„·ì§„í¥ì›(KISA) ì¸ì¦ íˆ´ì„ ë³´ë‚´ë“œë¦´ í…Œë‹ˆ ì‹¤í–‰í•´ì£¼ì„¸ìš”.", "min": 75, "type": "phishing"},
    {"id": "A06", "cat": "A", "name": "ê¸ˆê°ì› ì‚¬ì¹­", "text": "ê¸ˆìœµê°ë…ì› ìì‚°ë³´í˜¸íŒ€ì…ë‹ˆë‹¤. í˜„ì¬ ìê¸ˆì´ í•´ì™¸ë¡œ ë¹ ì ¸ë‚˜ê°€ê³  ìˆì–´ ì§€ê¸‰ì •ì§€ ìš”ì²­ì„ í•´ì•¼ í•˜ëŠ”ë°, ë³¸ì¸ ì¸ì¦ì´ ê³„ì† ì‹¤íŒ¨í•˜ë„¤ìš”. í†µì‹  ë³´ì•ˆì´ í™•ì‹¤í•œ ê³³ì—ì„œ ëŒ€ê¸°í•´ì£¼ì‹œë©´, ì €í¬ê°€ ì›ê²©ìœ¼ë¡œ 'ê¸ˆìœµ ë³´ì•ˆ ëª¨ë“ˆ'ì„ ì¬ì„¤ì •í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.", "min": 70, "type": "phishing"},
    {"id": "A07", "cat": "A", "name": "ê°€ì¡± ì‚¬ì¹­", "text": "ì•„ë²„ë‹˜, ì € ê¹€ ëŒ€ë¦¬ì…ë‹ˆë‹¤. ì•„ê¹Œ ë”°ë‹˜ì´ ì‚¬ê³  í•©ì˜ ê±´ìœ¼ë¡œ ê¸‰í•˜ê²Œ ì—°ë½ ì£¼ì…¨ëŠ”ë°, ì§€ê¸ˆ ìƒëŒ€ë°© ë³´í—˜ì‚¬ ì§ì›ì´ë‘ ëŒ€í™” ë‚´ìš©ì„ ë…¹ìŒí•´ì•¼ í•´ìš”. ì£¼ë³€ì´ ì‹œë„ëŸ¬ìš°ë©´ ì•ˆ ë˜ë‹ˆê¹Œ ì¡°ìš©í•œ ë°© ì¡ê³  ê³„ì‹œë©´, ì œê°€ ë³´ë‚´ë“œë¦¬ëŠ” 'ë³´í—˜ì‚¬ ì „ìš© ë…¹ì·¨ ì•±' ì¼œë‘ì„¸ìš”. ë”°ë‹˜ ë°”ê¿”ë“œë¦´ê²Œìš”.", "min": 70, "type": "phishing"},
    {"id": "A08", "cat": "A", "name": "ë©´ì ‘ ìœ„ì¥", "text": "ì•ˆë…•í•˜ì„¸ìš”, OOê¸°ì—… ì¸ì‚¬íŒ€ì…ë‹ˆë‹¤. 1ì°¨ í•©ê²© ì¶•í•˜ë“œë¦½ë‹ˆë‹¤. 2ì°¨ëŠ” AI ì—­ëŸ‰ ê²€ì‚¬ë¡œ ì§„í–‰ë˜ëŠ”ë°ìš”, ë¶€ì •í–‰ìœ„ ë°©ì§€ë¥¼ ìœ„í•´ ë…ë¦½ëœ ê³µê°„(ìˆ™ë°• ì‹œì„¤ ë“±)ì—ì„œ 360ë„ ì¹´ë©”ë¼ ì„¸íŒ…ì´ í•„ìš”í•©ë‹ˆë‹¤. ë³´ë‚´ë“œë¦¬ëŠ” 'ì‹œí—˜ ê°ë… í”„ë¡œê·¸ë¨' ì„¤ì¹˜ í›„ ì‘ì‹œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.", "min": 65, "type": "phishing"},
    {"id": "A09", "cat": "A", "name": "ê°€ì§œ ë°±ì‹ ", "text": "ê³ ê°ë‹˜, OOì¹´ë“œ FDS(ì´ìƒê±°ë˜íƒì§€)íŒ€ì…ë‹ˆë‹¤. ì§€ê¸ˆ ê³ ê°ë‹˜ í°ì— ì•…ì„±ì½”ë“œê°€ ì‹¬ì–´ì ¸ì„œ ê³„ì† ê²°ì œ ì‹œë„ê°€ ë“¤ì–´ì˜µë‹ˆë‹¤. ì €í¬ê°€ ì´ê±¸ ë§‰ìœ¼ë ¤ë©´ 'ë°±ì‹ 'ì„ ì—…ë°ì´íŠ¸í•´ì•¼ í•˜ëŠ”ë°, ë°ì´í„°ê°€ ì†ì‹¤ë  ìˆ˜ ìˆìœ¼ë‹ˆ ì´ë™í•˜ì§€ ë§ˆì‹œê³  í•œìë¦¬ì—ì„œ ì™€ì´íŒŒì´ ë„ê³  ì§„í–‰í•´ ì£¼ì„¸ìš”.", "min": 65, "type": "phishing"},
    {"id": "A10", "cat": "A", "name": "ìƒì²´ì¸ì¦ ìœ„ì¥", "text": "ë„¤, ê³ ê°ë‹˜. ë¶ˆí¸ ë“œë ¤ ì£„ì†¡í•©ë‹ˆë‹¤. ìµœê·¼ ë”¥ë³´ì´ìŠ¤ ë²”ì£„ê°€ ëŠ˜ì–´ë‚˜ì„œ, ë³¸ì¸ í™•ì¸ ì ˆì°¨ê°€ ê°•í™”ë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ ê³ ê°ë‹˜ ëª©ì†Œë¦¬ì˜ ìƒì²´ íŒŒí˜•(Voice Print)ì„ ë“±ë¡í•´ì•¼ ê³„ì¢Œ ì ê¸ˆì´ í’€ë¦¬ëŠ”ë°ìš”, ì´ê²Œ ë¯¸ì„¸í•œ ì†ŒìŒì—ë„ ì˜¤ë¥˜ê°€ ë‚©ë‹ˆë‹¤. ë²ˆê±°ë¡œìš°ì‹œê² ì§€ë§Œ, ì§€ê¸ˆ ê³„ì‹  ì¹´í˜ëŠ” ì†ŒìŒ ìˆ˜ì¹˜ê°€ ë†’ì•„ì„œ ì§„í–‰ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ê·¼ì²˜ì— ê³µìœ  ì˜¤í”¼ìŠ¤ë‚˜ ì¡°ìš©í•œ ìˆ™ì†Œ ê°™ì€ ê³³ì„ ì ì‹œ ì´ìš©í•´ ì£¼ì‹¤ ìˆ˜ ìˆì„ê¹Œìš”?", "min": 60, "type": "phishing"},

    # Category B: ì •ìƒ ì¼€ì´ìŠ¤ (11-13)
    {"id": "B01", "cat": "B", "name": "[ì •ìƒ] ì‹¬ë¦¬ìƒë‹´", "text": "ì•ˆë…•í•˜ì„¸ìš”, OOì •ì‹ ê±´ê°•ì˜í•™ê³¼ì…ë‹ˆë‹¤. ì˜ˆì•½í•˜ì‹  ë¹„ëŒ€ë©´ ì§„ë£Œ ì‹œê°„ ë˜ì…”ì„œ ì—°ë½ë“œë ¸ìŠµë‹ˆë‹¤. ì§„ë£Œ ë‚´ìš©ì— ë¯¼ê°í•œ ê°œì¸ ì •ë³´ê°€ í¬í•¨ë  ìˆ˜ ìˆìœ¼ë‹ˆ, ì§€ê¸ˆ ì£¼ë³€ì— ì‚¬ëŒì´ ì—†ëŠ” ì¡°ìš©í•œ ë°©ì´ë‚˜ ë…ë¦½ëœ ê³µê°„ìœ¼ë¡œ ì´ë™í•´ ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”? ì¹´í˜ë‚˜ ê³µê³µì¥ì†Œì‹œë©´ ì§„ë£Œê°€ ì–´ë µìŠµë‹ˆë‹¤. ì¤€ë¹„ë˜ì‹œë©´ ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ë³´ë‚´ë“œë¦° 'ë‹¥í„°ë‚˜ìš°(ë˜ëŠ” ì¤Œ)' ë§í¬ ëˆŒëŸ¬ì„œ í™”ìƒ ì§„ë£Œì‹¤ë¡œ ì…ì¥í•´ ì£¼ì„¸ìš”.", "max": 30, "type": "legitimate"},
    {"id": "B02", "cat": "B", "name": "[ì •ìƒ] ì›ê²©ì§€ì›", "text": "ê³ ê°ë‹˜, ë§ì”€í•˜ì‹  ì™€ì´íŒŒì´ ëŠê¹€ í˜„ìƒì€ ì„¤ì • ì¶©ëŒ ë¬¸ì œë¡œ ë³´ì…ë‹ˆë‹¤. ì œê°€ ê³ ê°ë‹˜ íœ´ëŒ€í° í™”ë©´ì„ ë³´ë©´ì„œ ì„¤ì •ì„ ì¢€ ì¡ì•„ë“œë ¤ì•¼ í•  ê²ƒ ê°™ì€ë°ìš”. íœ´ëŒ€í° ê¸°ë³¸ ì„¤ì • ë©”ë‰´ì— ë³´ì‹œë©´ 'ì›ê²© ìƒë‹´' ê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤. ê·¸ê±° ëˆ„ë¥´ì‹œê³  í™”ë©´ì— ëœ¨ëŠ” 6ìë¦¬ ì ‘ì† ë²ˆí˜¸ë¥¼ ì €í•œí…Œ ë¶ˆëŸ¬ì£¼ì‹œê² ì–´ìš”? ì—°ê²°ë˜ë©´ ì œê°€ í™”ë©´ì„ ì œì–´í•˜ë©´ì„œ í•´ê²°í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.", "max": 30, "type": "legitimate"},
    {"id": "B03", "cat": "B", "name": "[ì •ìƒ] ì±„ìš©ê²€ì‚¬", "text": "ì•ˆë…•í•˜ì„¸ìš”, OOê·¸ë£¹ ì¸ì‚¬íŒ€ ì±„ìš© ë‹´ë‹¹ìì…ë‹ˆë‹¤. ì„œë¥˜ í•©ê²© ì¶•í•˜ë“œë¦½ë‹ˆë‹¤. ë‚´ì¼ë¶€í„° ì§„í–‰ë˜ëŠ” ì˜¨ë¼ì¸ AI ì—­ëŸ‰ ê²€ì‚¬ ê´€ë ¨í•´ì„œ ì•ˆë‚´ ì „í™” ë“œë ¸ìŠµë‹ˆë‹¤. ë¶€ì •í–‰ìœ„ ë°©ì§€ë¥¼ ìœ„í•´ì„œ ë°˜ë“œì‹œ í˜¼ì ê³„ì‹  ê³µê°„ì—ì„œ ì‘ì‹œí•˜ì…”ì•¼ í•˜ê³ ìš”, ì›¹ìº ìœ¼ë¡œ ì£¼ë³€ 360ë„ë¥¼ ë¹„ì¶°ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤. ì‹œí—˜ í”„ë¡œê·¸ë¨ì€ ì €í¬ ì±„ìš© í™ˆí˜ì´ì§€ 'ë§ˆì´í˜ì´ì§€'ì—ì„œ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•˜ì‹œë‹ˆê¹Œ ë¯¸ë¦¬ ì„¤ì¹˜í•˜ê³  í…ŒìŠ¤íŠ¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤.", "max": 30, "type": "legitimate"},

    # Category C: URL ê¸°ë°˜ í”¼ì‹± (14-23)
    {"id": "C01", "cat": "C", "name": "ëŒ€ë²•ì› ìœ„ì¥", "text": "ë³¸ì¸ ì‚¬ê±´ì´ ë§ëŠ”ì§€ ì§ì ‘ í™•ì¸í•´ë³´ì„¸ìš”. ì¸í„°ë„· ì£¼ì†Œì°½ì— scourt-law.com ì…ë ¥í•˜ì‹œë©´ ëŒ€ë²•ì› í˜•ì‚¬ ì‚¬ë²• í¬í„¸ ë‚˜ì˜µë‹ˆë‹¤. ê±°ê¸°ì„œ 'ì‚¬ê±´ ì¡°íšŒ' ëˆ„ë¥´ì‹œê³  ì„±í•¨ ì…ë ¥í•´ ë³´ì„¸ìš”. íŒê²°ë¬¸ ìì„¸íˆ ë³´ì‹œë ¤ë©´ ë³´ì•ˆ ë·°ì–´(Viewer) ì„¤ì¹˜í•˜ë¼ê³  ëœ¨ì£ ? ê·¸ê±° ì„¤ì¹˜í•˜ì„¸ìš”.", "min": 70, "type": "phishing"},
    {"id": "C02", "cat": "C", "name": "ê²€ì°°ì²­ ìœ„ì¥", "text": "ë°”ì˜ì‹œë‹ˆê¹Œ ì„œìš¸ì¤‘ì•™ì§€ê²€ í™ˆí˜ì´ì§€(spo-invest.net) ì ‘ì†í•˜ì…”ì„œ 'ë¹„ëŒ€ë©´ ì¡°ì‚¬ì‹¤' ë°°ë„ˆ í´ë¦­í•˜ì„¸ìš”. ê³µì¸ì¸ì¦ì„œ ëŒ€ì‹  'ìˆ˜ì‚¬ê¸°ê´€ìš© ë³¸ì¸í™•ì¸ ì•±'ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì…”ì•¼ í•©ë‹ˆë‹¤.", "min": 75, "type": "phishing"},
    {"id": "C03", "cat": "C", "name": "ê¸ˆê°ì› ë™ê²°", "text": "ì§€ê¸ˆ ê³„ì¢Œê°€ 1ì‹œê°„ ë’¤ì— ë™ê²°ë©ë‹ˆë‹¤. ê¸ˆìœµê°ë…ì› ë¯¼ì› í¬í„¸(fss-secure.co.kr) ë“¤ì–´ê°€ì…”ì„œ 'ë¶ˆë²• ê³„ì¢Œ í•´ì œ ì‹ ì²­' ëˆ„ë¥´ì„¸ìš”. ê±°ê¸°ì„œ í•˜ë¼ëŠ” ëŒ€ë¡œ ë³´ì•ˆ í”„ë¡œê·¸ë¨ ì—…ë°ì´íŠ¸í•˜ì…”ì•¼ ë™ê²° ë§‰ìŠµë‹ˆë‹¤.", "min": 75, "type": "phishing"},
    {"id": "C04", "cat": "C", "name": "êµ­ì„¸ì²­ í™˜ê¸‰", "text": "ê³ ê°ë‹˜, êµ­ì„¸ì²­ì…ë‹ˆë‹¤. 2024ë…„ë„ ë¯¸í™˜ê¸‰ ì„¸ì•¡ 320ë§Œ ì›ì´ ì¡°íšŒë˜ì‹œëŠ”ë° ì‹ ì²­ì´ ì•ˆ ë˜ì–´ ìˆì–´ì„œìš”. ëª¨ë°”ì¼ í™ˆíƒìŠ¤ ì£¼ì†Œ ë³´ë‚´ë“œë¦´ê²Œìš”(hometax-refund.info). ì—¬ê¸° ì ‘ì†í•´ì„œ 'í™˜ê¸‰ ì‹ ì²­ì„œ' ë‹¤ìš´ë°›ì•„ ì‘ì„±í•´ì„œ ë‹¤ì‹œ ì˜¬ë¦¬ì„¸ìš”.", "min": 70, "type": "phishing"},
    {"id": "C05", "cat": "C", "name": "ê±´ê°•ê²€ì§„ ìœ„ì¥", "text": "ê±´ê°•ê²€ì§„ì„¼í„°ì…ë‹ˆë‹¤. ì´ë²ˆ ê²€ì‚¬ ê²°ê³¼ì—ì„œ ì¤‘ëŒ€í•œ ì´ìƒ ì†Œê²¬ì´ ë°œê²¬ë˜ì–´ ì •ë°€ ê²€ì‚¬ê°€ í•„ìš”í•©ë‹ˆë‹¤. ìì„¸í•œ ìˆ˜ì¹˜ëŠ” ì˜ë£Œ í¬í„¸(health-check.kr)ì—ì„œ ê²°ê³¼ì§€ ì¡°íšŒí•´ ë³´ì„¸ìš”. ê²°ê³¼ì§€ í™•ì¸ ë²„íŠ¼ ëˆ„ë¥´ë©´ ì˜ë£Œ ì •ë³´ ì•”í˜¸í™” ëª¨ë“ˆ ì„¤ì¹˜ í•„ìš” íŒì—… ëœ° ê²ë‹ˆë‹¤.", "min": 65, "type": "phishing"},
    {"id": "C06", "cat": "C", "name": "ì¥í•™ê¸ˆ ìœ„ì¥", "text": "í•œêµ­ì¥í•™ì¬ë‹¨ì…ë‹ˆë‹¤. ë¶€ëª¨ë‹˜ ì†Œë“ ì •ë³´ ì˜¤ë¥˜ë¡œ ì¥í•™ê¸ˆ í™˜ìˆ˜ ëŒ€ìƒì´ ë˜ì…¨ì–´ìš”. ì´ì˜ ì‹ ì²­í•˜ì‹œë ¤ë©´ ì¬ë‹¨ ì‚¬ì´íŠ¸(kosaf-support.com) ê°€ì…”ì„œ ì¦ë¹™ ì„œë¥˜ ì œì¶œ ì•±ì„ ê¹Œì…”ì•¼ í•©ë‹ˆë‹¤.", "min": 70, "type": "phishing"},
    {"id": "C07", "cat": "C", "name": "ëŒ€í™˜ëŒ€ì¶œ ìœ„ì¥", "text": "ì •ë¶€ ì§€ì› 'í–‡ì‚´ë¡ ' ëŒ€ìƒìë¡œ ì„ ì •ë˜ì…¨ìŠµë‹ˆë‹¤. ê¸°ì¡´ ê³ ê¸ˆë¦¬ ëŒ€ì¶œì„ 3%ëŒ€ë¡œ ëŒ€í™˜í•´ ë“œë¦½ë‹ˆë‹¤. KBêµ­ë¯¼ì€í–‰ íŠ¹íŒ ì‚¬ì´íŠ¸(kb-loancenter.net)ì—ì„œ í•œë„ ì¡°íšŒí•˜ê³  ì‹ ì²­ ì•± ì„¤ì¹˜í•˜ì„¸ìš”.", "min": 65, "type": "phishing"},
    {"id": "C08", "cat": "C", "name": "íƒë°° ìŠ¤ë¯¸ì‹±", "text": "[CJëŒ€í•œí†µìš´] ìš´ì†¡ì¥ ë²ˆí˜¸ 450-*** ì£¼ì†Œì§€ ë¶ˆëª…ìœ¼ë¡œ ë°˜ì†¡ ëŒ€ê¸° ì¤‘. ì‹¤ì‹œê°„ ì£¼ì†Œì§€ ìˆ˜ì •: cj-logistics-help.com ë³¸ì¸ í™•ì¸ì„ ìœ„í•´ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê³  ì¸ì¦ ì•±ì„ ì„¤ì¹˜í•˜ì„¸ìš”.", "min": 60, "type": "phishing"},
    {"id": "C09", "cat": "C", "name": "ì½”ì¸ ê±°ë˜ì†Œ", "text": "ì—…ë¹„íŠ¸ ë³´ì•ˆíŒ€ì…ë‹ˆë‹¤. ë¯¸êµ­ì—ì„œ ë¡œê·¸ì¸ì´ ì‹œë„ë˜ì–´ ì¶œê¸ˆì´ ì œí•œëìŠµë‹ˆë‹¤. í•´ì œí•˜ì‹œë ¤ë©´ ì „ìš© ë³´ì•ˆ í˜ì´ì§€(upbit-security.org)ì—ì„œ OTP ì¬ì„¤ì • ì•±ì„ ë‹¤ìš´ë¡œë“œí•˜ì…”ì•¼ í•©ë‹ˆë‹¤.", "min": 70, "type": "phishing"},
    {"id": "C10", "cat": "C", "name": "2ì°¨ í”¼í•´", "text": "ì‚¬ì´ë²„ìˆ˜ì‚¬ëŒ€ì…ë‹ˆë‹¤. ì§€ë‚œë²ˆ ì‹ ê³ í•˜ì‹  ì‚¬ê¸° í”¼í•´ê¸ˆ ì°¾ì•˜ìŠµë‹ˆë‹¤. í™˜ê¸‰ ì ˆì°¨ ë°Ÿìœ¼ì‹œë ¤ë©´ ê²½ì°°ì²­ ì‚¬ì´ë²„ ì•ˆì „êµ­(cyber-police.me) ì ‘ì†í•˜ì…”ì„œ 'í”¼í•´ êµ¬ì œ ì‹ ì²­ì„œ' ì‘ì„±í•˜ì„¸ìš”.", "min": 70, "type": "phishing"},

    # Category D: ì‹ ê·œ ê³µê²© ìœ í˜• (24-27)
    {"id": "D01", "cat": "D", "name": "ë¡œë§¨ìŠ¤ ìŠ¤ìº ", "text": "ì˜¤ë¹ , ë‚˜ ì˜¤ëŠ˜ ì´ë”ë¦¬ì›€ ì„ ë¬¼ë¡œ 20% ë¨¹ì—ˆì–´ ã…‹ã…‹ ì €ë²ˆì— ë§í•œ ê·¸ AI ë§¤ë§¤ í”„ë¡œê·¸ë¨ ë•ë¶„ì´ì•¼. ë‚´ê°€ ì“°ëŠ” ê±°ë˜ì†ŒëŠ” ì•„ì§ í•œêµ­ì— ì•ˆ ì•Œë ¤ì§„ ë¹„ê³µê°œ ê±°ë˜ì†Œ(Private Exchange)ì¸ë°, ë ˆë²„ë¦¬ì§€ë¥¼ 100ë°°ê¹Œì§€ ì¤˜. ì˜¤ë¹ ë„ í€€íŠ¸ ê´€ì‹¬ ë§ìœ¼ë‹ˆê¹Œ ë‚´ê°€ ì´ˆëŒ€ ì½”ë“œ ì¤„ê²Œ. ë”± 100ë§Œ ì›ë§Œ ë„£ì–´ì„œ í…ŒìŠ¤íŠ¸í•´ ë´.", "min": 60, "type": "phishing"},
    {"id": "D02", "cat": "D", "name": "ë”¥ë³´ì´ìŠ¤ ë‚©ì¹˜", "text": "(ìš¸ë¨¹ì´ëŠ” ëª©ì†Œë¦¬ë¡œ) ì•„ë¹ ! ë‚˜ ì‚¬ê³  ì³¤ì–´... íš¡ë‹¨ë³´ë„ì—ì„œ ì‚¬ëŒì„ ì³¤ëŠ”ë° í•©ì˜ê¸ˆ ì•ˆ ì£¼ë©´ ë‹¹ì¥ êµ¬ì†ëœëŒ€. í•¸ë“œí°ë„ ëºê²¼ì–´. ì˜†ì— ì•„ì €ì”¨ ë°”ê¿”ì¤„ê²Œ. (ê³µë²” ë“±ì¥) ìë…€ë¶„ì´ ì§€ê¸ˆ ì‚¬ëŒì„ í¬ê²Œ ë‹¤ì¹˜ê²Œ í–ˆìŠµë‹ˆë‹¤. ê²½ì°° ë¶€ë¥´ê¸° ì „ì— ì¡°ìš©íˆ í•©ì˜ ë³´ì‹œì£ . ì§€ê¸ˆ ë‹¹ì¥ 3,000ë§Œ ì› ë³´ë‚´ì‹œë©´ ì—†ë˜ ì¼ë¡œ í•©ë‹ˆë‹¤.", "min": 70, "type": "phishing"},
    {"id": "D03", "cat": "D", "name": "ë¶€ê³ ì¥ ìŠ¤ë¯¸ì‹±", "text": "[ë¶€ê³ ] ëª¨ì¹œìƒ. ì¥ë¡€ì‹ì¥: ì—°ì„¸ì„¸ë¸Œë€ìŠ¤ë³‘ì›. ë°”ì˜ì‹œë”ë¼ë„ ì°¸ì„ ë¶€íƒë“œë¦½ë‹ˆë‹¤. ì•½ë„/ëª¨ë°”ì¼ ë¶€ê³ ì¥ ë³´ê¸°: bit.ly/funeral_kr", "min": 50, "type": "phishing"},
    {"id": "D04", "cat": "D", "name": "ê³ ìˆ˜ìµ ì•Œë°”", "text": "ì €í¬ëŠ” ë²•ë¬´ì‚¬ ì‚¬ë¬´ì‹¤ì¸ë°ìš”, ì„¸ê¸ˆ ë¬¸ì œ ë•Œë¬¸ì— ë²•ì¸ í†µì¥ì„ ëª» ì¨ìš”. ì„¸ì˜ ì”¨ ê°œì¸ ê³„ì¢Œë¡œ ëˆì„ ë°›ì•„ì„œ ì €í¬ê°€ ì•Œë ¤ì£¼ëŠ” ê³„ì¢Œë¡œ ì´ì²´ë§Œ í•´ì£¼ì‹œë©´ ê±´ë‹¹ 10ë§Œ ì› ë“œë ¤ìš”. í˜¹ì‹œ ì§€ê¸ˆ ë©´ì ‘ ë³´ëŸ¬ ì˜¤ê¸° í˜ë“œì‹œë©´, ë¨¼ì € ì—…ë¬´ í…ŒìŠ¤íŠ¸ë¶€í„° í•´ë³¼ê²Œìš”. ì§€ê¸ˆ ì…ê¸ˆëœ ëˆ ì°¾ì•„ì„œ ê·¼ì²˜ ì½”ì¸ ATMê¸° ê°€ì„œ ì†¡ê¸ˆí•´ ë³´ì„¸ìš”.", "min": 60, "type": "phishing"},
]


def main():
    print("=" * 80)
    print("ğŸ§ª Gemini 2.5 Flash + Rule Filter ë²¤ì¹˜ë§ˆí¬ (27ê°œ ì¼€ì´ìŠ¤)")
    print("=" * 80)
    print()

    detector = GeminiPhishingDetector()

    results = []
    correct = 0
    total = len(test_cases)

    category_results = {"A": [], "B": [], "C": [], "D": []}

    for i, case in enumerate(test_cases, 1):
        print(f"[{i}/{total}] {case['id']}: {case['name']}")
        print(f"í…ìŠ¤íŠ¸: {case['text'][:80]}...")

        try:
            # Gemini + Filter ë¶„ì„ (enable_filter=True)
            result = detector.analyze(case["text"], enable_filter=True)

            score = result["score"]
            is_phishing = result["is_phishing"]
            risk_level = result["risk_level"]

            # ì •ë‹µ íŒì •
            if case["type"] == "phishing":
                expected_min = case["min"]
                is_correct = score >= expected_min
                status = "âœ“" if is_correct else "âœ—"
                print(f"  ìµœì¢… ì ìˆ˜: {score} (ê¸°ëŒ€: â‰¥{expected_min})")
            else:  # legitimate
                expected_max = case["max"]
                is_correct = score <= expected_max
                status = "âœ“" if is_correct else "âœ—"
                print(f"  ìµœì¢… ì ìˆ˜: {score} (ê¸°ëŒ€: â‰¤{expected_max})")

            print(f"  ìœ„í—˜ë„: {risk_level}")
            print(f"  íŒì •: {'í”¼ì‹±' if is_phishing else 'ì •ìƒ'}")

            # Filter ì ìš© ì—¬ë¶€ í‘œì‹œ
            if result.get("filter_applied"):
                llm_score = result.get("llm_score", score)
                if llm_score != score:
                    arrow = "â†“" if score < llm_score else "â†‘"
                    print(f"  âœ“ Rule Filter ì ìš©: {llm_score} {arrow} {score}")

            print(f"  ê²°ê³¼: {status}")
            print("-" * 80)

            if is_correct:
                correct += 1

            category_results[case["cat"]].append({
                "case": case,
                "score": score,
                "is_correct": is_correct
            })

            results.append({
                "id": case["id"],
                "name": case["name"],
                "score": score,
                "is_correct": is_correct
            })

            # API ê³¼ë¶€í•˜ ë°©ì§€
            time.sleep(1)

        except Exception as e:
            print(f"  âœ— ì˜¤ë¥˜: {str(e)}")
            print("-" * 80)
            results.append({
                "id": case["id"],
                "name": case["name"],
                "score": 0,
                "is_correct": False
            })

    print()
    print("=" * 80)
    print("ğŸ“Š ìµœì¢… ê²°ê³¼")
    print("=" * 80)

    accuracy = (correct / total) * 100
    print(f"ì „ì²´ ì •í™•ë„: {accuracy:.1f}% ({correct}/{total})")
    print()

    # ì¹´í…Œê³ ë¦¬ë³„ ì •í™•ë„
    print("ğŸ“ˆ ì¹´í…Œê³ ë¦¬ë³„ ì •í™•ë„:")
    for cat_name, cat_label in [("A", "ì „í†µì  í”¼ì‹±"), ("B", "ì •ìƒ ì¼€ì´ìŠ¤"),
                                  ("C", "URL í”¼ì‹±"), ("D", "ì‹ ê·œ ê³µê²©")]:
        cat_results = category_results[cat_name]
        if cat_results:
            cat_correct = sum(1 for r in cat_results if r["is_correct"])
            cat_total = len(cat_results)
            cat_acc = (cat_correct / cat_total) * 100
            print(f"  Category {cat_name} ({cat_label}): {cat_acc:.1f}% ({cat_correct}/{cat_total})")

    print()
    print("ğŸ“ˆ Rule Filter í†µê³„:")
    stats = detector.rule_filter.get_statistics()
    print(f"  ì´ í•„í„°ë§: {stats['total_filtered']}")
    print(f"  ê²©í•˜(Downgrade): {stats['downgraded']} ({stats['downgrade_rate']:.1f}%)")
    print(f"  ìƒí–¥(Upgrade): {stats['upgraded']} ({stats['upgrade_rate']:.1f}%)")
    print(f"  í†µê³¼: {stats['passed']}")

    print()
    print("âœ… ë²¤ì¹˜ë§ˆí¬ ì™„ë£Œ!")


if __name__ == "__main__":
    main()
